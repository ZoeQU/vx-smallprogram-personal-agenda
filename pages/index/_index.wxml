<view class="container">
  <view class="header">
    <text class="title">日程表</text>
  </view>

  <scroll-view scroll-y class="schedule">
    <!-- 时间表 -->
    <block wx:for="{{timeSlots}}" wx:key="time">
    <view
        class="time-slot {{item.isStartOfHour ? 'hour-start' : ''}} {{item.isEndOfHour ? 'hour-end' : ''}} {{item.isMerged ? 'merged-slot' : ''}}"
        style="{{item.style}}"
        data-index="{{index}}"
        bindtap="handleSlotClick"
        bindlongpress="handleLongPress"
    >
        <view class="slot-content">
        <text>{{item.time}}</text>
        <!-- 红点标志 -->
        <view wx:if="{{item.hasContent}}" class="content-marker"></view>
        </view>
    </view>
    </block>
  </scroll-view>

  <!-- index.wxml 修改弹窗部分 -->
  <view wx:if="{{showModal}}" class="modal" bindtap="handleCloseModal">
    <view class="modal-content" catchtap="stopPropagation">
        <text class="modal-title">时间块详情</text>
        <textarea
        class="input-text"
        placeholder="请输入内容"
        bindinput="handleTextInput"
        value="{{inputText}}"
        auto-focus
        ></textarea>
        <button class="save-btn" bindtap="handleSaveContent">保存</button>
    </view>

  </view>
    <!-- 添加操作按钮 -->
    <view wx:if="{{selectedBlocks.length > 0}}" class="action-bar">
    <button class="merge-btn" bindtap="handleMergeBlocks">合并选中区块</button>
    <button class="split-btn" bindtap="handleSplitBlocks">拆分当前区块</button>
  </view>

  <view 
    class="time-slot {{isSelecting ? 'selecting' : ''}}"
    style="{{item.style}}"
  >
    <checkbox 
      wx:if="{{isSelecting}}"
      class="checkbox"
      checked="{{selectedBlocks.indexOf(index) !== -1}}"
      color="#4CAF50"
      data-index="{{index}}"
      bindtap="handleCheckboxTap"
    />
    
    <view 
      class="slot-content {{item.isMerged ? 'merged' : ''}}"
      data-index="{{index}}"
      bindtap="handleSlotTap"
      bindlongpress="handleLongPress"
    >
      <text class="time-text">{{item.time}}</text>
      <view wx:if="{{item.hasContent}}" class="content-marker"></view>
    </view>
  </view>

  <view wx:if="{{isSelecting}}" class="selection-toolbar">
    <button bindtap="handleConfirmSelection">完成选择</button>
    <button bindtap="handleCancelSelection">取消</button>
  </view>

<!-- index.wxml 修改时间块结构 -->
<view class="time-slot {{item.isMerged ? 'merged-slot' : ''}} {{isSelecting ? 'selecting' : ''}}">
  <!-- 勾选框 -->
  <checkbox 
    wx:if="{{isSelecting}}"
    checked="{{selectedBlocks.includes(index)}}"
    class="checkbox"
    color="#4CAF50"
  />
  <view 
    class="slot-content"
    data-index="{{index}}"
    bindtap="handleSlotClick"
    bindlongpress="handleLongPress"
  >
    <!-- 原有内容保持不变 -->
  </view>
</view>

<!-- 添加合并操作栏 -->
<view wx:if="{{isSelecting}}" class="selection-toolbar">
  <button class="btn-merge" bindtap="handleMergeSelection">合并选中项</button>
  <button class="btn-cancel" bindtap="handleCancelSelection">取消</button>
</view>

</view>